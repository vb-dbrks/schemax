---
sidebar_position: 103
title: Test Coverage Checklist
---
# Test Coverage Checklist: Align With TESTING.md

This document turns **every scenario documented in [Testing](/reference/testing)** into a coverage checklist so that release-ready test coverage explicitly includes each documented area.

---

## 1. Python SDK — Documented Scenarios vs Coverage

### 1.1 Apply Command Tests (TESTING.md lines 84–98)

| Scenario | Documented | Test location | Status |
|----------|------------|----------------|--------|
| Non-interactive mode auto-creates snapshot | Yes | `tests/unit/test_apply_command.py` | Verify |
| Interactive mode prompts for snapshot | Yes | same | Verify |
| Interactive mode create snapshot choice | Yes | same | Verify |
| SQL preview non-interactive skips prompt | Yes | same | Verify |
| Workspace without uncommitted ops (no prompts) | Yes | same | Verify |

**Action**: Confirm all five apply-command scenarios are covered; add or fix tests for any gap.

---

### 1.2 View Dependency Tests (TESTING.md lines 108–156)

**Integration** (`tests/integration/test_view_dependencies.py`):

| Scenario | Documented | Status |
|----------|------------|--------|
| Unqualified table refs qualified with backticks (regression) | Yes | Verify |
| View with multiple tables all qualified (JOINs) | Yes | Verify |
| CREATE + UPDATE view batched (squashing) | Yes | Verify |
| CREATE + multiple UPDATEs batched (last wins) | Yes | Verify |
| View dependencies sorted (topological) | Yes | Verify |
| Circular view dependency detection (graceful fallback) | Yes | Verify |

**State differ** (`tests/unit/test_state_differ.py`):

| Scenario | Documented | Status |
|----------|------------|--------|
| Diff added view | Yes | Verify |
| Diff removed view | Yes | Verify |
| Diff renamed view with history | Yes | Verify |
| Diff view definition change | Yes | Verify |
| Diff view comment change | Yes | Verify |
| Diff multiple views added (regression) | Yes | Verify |
| New schema with views includes all views (regression) | Yes | Verify |
| New catalog with views includes all views (regression) | Yes | Verify |
| Generic object coverage (catch missing object types) | Yes | Verify |

**Dependency graph** (`tests/unit/test_dependency_graph.py`):

| Scenario | Documented | Status |
|----------|------------|--------|
| Cycle detection with detailed paths | Yes | Verify |
| Topological sorting | Yes | Verify |
| Breaking change detection | Yes | Verify |

**Action**: Audit each listed scenario; add or fix tests so every row has a passing test.

---

### 1.3 Test Structure (Unit / Integration) (TESTING.md lines 49–70)

| Area | Documented file | Coverage requirement |
|------|------------------|----------------------|
| V4 storage layer | `test_storage_v4.py` | create project, read/write project, changelog, snapshots, load_current_state, ensure_project_file |
| SQL generation | `test_sql_generator.py` | All op types: catalog, schema, table, column, constraint, **row filter**, **column mask**, tags, properties, views |
| State reducer | `test_state_reducer.py` | All op types applied to state (including row filter, column mask) |
| State differ | `test_state_differ.py` | All object types diffed (catalogs, schemas, tables, columns, views, constraints, row filters, column masks) |
| Catalog mapping | `test_catalog_mapping.py` | Logical → physical per env, __implicit__, multi-catalog error |
| Unity executor | `test_unity_executor.py` | Execute statements, auth, error handling (mocked) |
| Deployment tracker | `test_deployment_tracker.py` | start/complete deployment, record ops, get_latest_deployment |
| Dependency graph | `test_dependency_graph.py` | Cycles, topological sort, breaking change |
| Apply command | `test_apply_command.py` | See 1.1 |
| Integration workflows | `test_workflows.py`, `test_command_workflows.py` | init → sql, init → validate → snapshot create → diff, apply/rollback (mocked), import (if any) |
| View dependencies | `test_view_dependencies.py` | See 1.2 |
| Providers base | `providers/base/test_hierarchy.py` | Hierarchy / provider contract |

**Action**: For each area, ensure at least one test per documented behavior; add row filter/column mask where listed.

---

### 1.4 Current Status Claims (TESTING.md lines 72–80)

| Claim | Verification |
|-------|---------------|
| 306 tests passing (12 skipped) | Run pytest; update doc if count changed |
| SQLGlot validation integrated | Tests that assert SQLGlot parse of generated SQL |
| Dependency graph tests (cycle, topological) | Covered in 1.2 |
| View support tests + FQN regression | Covered in 1.2 |
| State differ generic tests | Covered in 1.2 |
| Code coverage reporting | pytest --cov, jest coverage |
| Non-interactive mode tests | Covered in 1.1 |

**Action**: Re-run tests and coverage; update TESTING.md numbers and status if needed.

---

## 2. VS Code Extension — Documented Scenarios vs Coverage

### 2.1 Test Structure (TESTING.md lines 188–212)

| Area | Documented | Test file | Coverage requirement |
|------|------------|-----------|----------------------|
| Storage layer | Yes | `storage-v4.test.ts` | create project, read project, changelog, snapshots (match TESTING.md patterns) |
| ColumnGrid | Yes | `ColumnGrid.test.tsx` | Render columns, add/rename (match doc patterns) |
| Sidebar | Yes | `Sidebar.test.tsx` | Tree, actions |
| TableConstraints | Yes | `TableConstraints.test.tsx` | Constraints UI |
| Providers base | Yes | `hierarchy.test.ts` | Hierarchy / provider contract |

**Action**: Ensure each listed file has tests for the scenarios implied by TESTING.md (storage, render, user actions).

### 2.2 Patterns and Fixtures (TESTING.md lines 216–278)

| Item | Coverage requirement |
|------|----------------------|
| Storage layer pattern (mock fs) | At least one test using mock fs for read/write |
| React component pattern (mock store) | At least one test using mock useDesignerStore |
| SQL generator example (add_catalog) | Optional: TS SQL generator test for one op type; or rely on Python |
| Mocking VS Code API (window, workspace) | `__mocks__/vscode.ts` used by tests; no unmocked vscode in tests |
| Fixtures (sample-project-v4, changelog, snapshot, state) | Tests use fixtures where appropriate |

**Action**: Confirm patterns are used in at least one test each; add minimal tests if a pattern is documented but unused.

### 2.3 Coverage Thresholds (TESTING.md lines 280–293)

- Baseline thresholds in `jest.config.js` (branches, functions, lines, statements).
- Doc says ~4% overall, React 10–25%, "Demonstrating testing infrastructure and patterns."

**Action**: Run Jest with coverage; update TESTING.md "Current Coverage" and "Last Updated" if numbers or thresholds change.

---

## 3. Integration and Smoke — Documented Scenarios

### 3.1 Integration (TESTING.md lines 296–312)

| Scenario | Documented | Action |
|----------|------------|--------|
| From project root / example: validate schema | Yes | Smoke or integration test runs `schemax validate` in example |
| Generate SQL (schemax sql) | Yes | Smoke or integration test runs `schemax sql` (or sql --output file) |
| CI: integration-tests.yml (build, install, CLI on example) | Yes | Ensure workflow runs and uses same scenarios |

**Action**: Ensure at least one script or workflow runs validate + sql on example project; document in TESTING.md.

### 3.2 Smoke (TESTING.md lines 314–326)

| Step | Documented | Action |
|------|------------|--------|
| Build VS Code extension | Yes | smoke-test.sh or equivalent |
| Validate extension package | Yes | Same |
| Install Python SDK | Yes | Same |
| Validate example schema with CLI | Yes | Same |

**Action**: Ensure smoke script runs all four steps; TESTING.md already lists them.

### 3.3 Quality Checks (TESTING.md lines 328–344)

| Step | Documented | Action |
|------|------------|--------|
| Python formatting (Black, 100 char) | Yes | devops/run-checks.sh |
| Python linting (Ruff) | Yes | Same |
| Python SDK tests (pytest) | Yes | Same |
| VS Code Extension tests (Jest) | Yes | Same |
| Smoke tests | Yes | Same |

**Action**: No new tests; ensure run-checks.sh runs all five and TESTING.md is accurate.

---

## 4. Test Development Guidelines (TESTING.md lines 368–416)

| Guideline | Coverage requirement |
|-----------|----------------------|
| Arrange-Act-Assert | New tests follow AAA where applicable |
| Naming (descriptive, action-oriented) | New tests use clear names |
| Isolation (independent, beforeEach, mocks) | No shared mutable state across tests |
| Coverage goals (70%+ overall, 80%+ critical) | Track coverage; add tests for critical paths (storage, sql_generator, rollback, apply) |
| Fixtures (sample-project-v4, changelog, snapshot, state) | Reuse fixtures; add new ones for row filter/column mask/baseline if needed |
| Operation builders (Python) | Use OperationBuilder in new Python tests |

**Action**: Apply these when adding tests for row filters, column masks, baseline rollback, and any new feature.

---

## 5. Release-Ready Verification Checklist

Use this as the release-ready verification checklist. Every row should be "covered" (test exists and passes or step is run in CI/smoke).

### Python SDK

- [ ] Apply command: all 5 scenarios (noninteractive auto-snapshot, interactive prompt, create choice, SQL preview no prompt, no uncommitted ops)
- [ ] View integration: all 6 scenarios (FQN regression, multiple tables, CREATE+UPDATE batched, multiple UPDATEs, sort, circular)
- [ ] View state differ: all 9 scenarios (add/remove/rename/definition/comment/multiple/new schema/new catalog/generic)
- [ ] Dependency graph: cycle, topological sort, breaking change
- [ ] Storage V4: create/read/write project, changelog, snapshots, load_current_state, ensure_project_file
- [ ] SQL generator: catalog, schema, table, column, constraint, **row filter**, **column mask**, tags, properties, views
- [ ] State reducer: all op types including row filter, column mask
- [ ] State differ: all object types including row filter, column mask
- [ ] Catalog mapping, executor, deployment tracker: at least one test per documented behavior
- [ ] Integration workflows: init→sql, validate→snapshot→diff, apply/rollback (mocked), import if documented
- [ ] Validate command: success, invalid state, stale snapshots, --json
- [ ] Rollback: partial, complete, idempotency, **baseline block**, **--force override** (after implementing)

### VS Code Extension

- [ ] Storage V4: create/read project, changelog, snapshots (per doc patterns)
- [ ] ColumnGrid, Sidebar, TableConstraints: render and key actions
- [ ] Providers base: hierarchy
- [ ] Fixtures and mocks used; coverage run and doc updated if needed

### Integration & Smoke

- [ ] Integration: validate + sql on example project (script or workflow)
- [ ] Smoke: build extension, validate package, install SDK, validate example with CLI
- [ ] Quality checks: formatting, lint, pytest, Jest, smoke all run in devops/run-checks.sh

### Docs

- [ ] TESTING.md: "Last Updated", test count, status, coverage % match current runs
- [ ] Any new scenario (row filter, column mask, baseline/--force) added to TESTING.md with test location

---

## 6. Relation to Other Plans

- **Release-ready checklist**: Add a bullet: "Test coverage aligns with TESTING.md: every scenario in TESTING.md has a corresponding passing test or CI/smoke step."
- **Row filters / column masks / baseline plan**: When adding tests for row filter SQL, column mask SQL, baseline storage, and rollback --force, add them under the appropriate TESTING.md areas (`test_sql_generator.py`, `test_rollback_*.py`, `test_import_*.py`) and update TESTING.md "Test Structure" and "Current Status" if needed.

This checklist uses TESTING.md as the single source of truth for "what we test" and ensures coverage explicitly includes every documented scenario.
